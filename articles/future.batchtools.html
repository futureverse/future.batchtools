<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>A Future for batchtools • future.batchtools</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="A Future for batchtools">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-SB3EQSD9FR"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-SB3EQSD9FR');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">future.batchtools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.12.2-9943</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/future.batchtools.html">A Future for batchtools</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://www.futureverse.org/"><span class="fa fas fa-home"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-packages" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Packages</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-packages">
<li><a class="external-link dropdown-item" href="https://doFuture.futureverse.org">doFuture (map-reduce)</a></li>
    <li><a class="external-link dropdown-item" href="https://furrr.futureverse.org">furrr (map-reduce)</a></li>
    <li><a class="external-link dropdown-item" href="https://future.futureverse.org">future</a></li>
    <li><a class="external-link dropdown-item" href="https://future.apply.futureverse.org">future.apply (map-reduce)</a></li>
    <li><a class="dropdown-item" href="https://future.batchtools.futureverse.org">future.batchtools (backend)</a></li>
    <li><a class="external-link dropdown-item" href="https://future.callr.futureverse.org">future.callr (backend)</a></li>
    <li><a class="external-link dropdown-item" href="https://future.mirai.futureverse.org">future.mirai (backend)</a></li>
    <li><a class="external-link dropdown-item" href="https://future.tests.futureverse.org">future.tests</a></li>
    <li><a class="external-link dropdown-item" href="https://globals.futureverse.org">globals</a></li>
    <li><a class="external-link dropdown-item" href="https://listenv.futureverse.org">listenv</a></li>
    <li><a class="external-link dropdown-item" href="https://parallelly.futureverse.org">parallelly</a></li>
    <li><a class="external-link dropdown-item" href="https://progressr.futureverse.org">progressr</a></li>
    <li><a class="external-link dropdown-item" href="https://BiocParallel.FutureParam.futureverse.org">BiocParallel.FutureParam (experimental)</a></li>
    <li><a class="external-link dropdown-item" href="https://future.tools.futureverse.org">future.tools (experimental)</a></li>
    <li><a class="external-link dropdown-item" href="https://future.mapreduce.futureverse.org">future.mapreduce (experimental)</a></li>
    <li><a class="external-link dropdown-item" href="https://marshal.futureverse.org">marshal (experimental)</a></li>
  </ul>
</li>
<li class="nav-item"><a class="external-link nav-link" href="https://cloud.r-project.org/package=future.batchtools"><span class="fa fab fa-r-project"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/futureverse/future.batchtools/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>A Future for batchtools</h1>
                        <h4 data-toc-skip class="author">Henrik
Bengtsson</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/futureverse/future.batchtools/blob/HEAD/vignettes/future.batchtools.md.rsp" class="external-link"><code>vignettes/future.batchtools.md.rsp</code></a></small>
      <div class="d-none name"><code>future.batchtools.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <strong><a href="https://cran.r-project.org/package=future" class="external-link">future</a></strong>
package provides a generic API for using futures in R. A future is a
simple yet powerful mechanism to evaluate an R expression and retrieve
its value at some point in time. Futures can be resolved in many
different ways depending on which strategy is used. There are various
types of synchronous and asynchronous futures to choose from in the
<strong><a href="https://cran.r-project.org/package=future" class="external-link">future</a></strong>
package.</p>
<p>This package, <strong><a href="https://cran.r-project.org/package=future.batchtools" class="external-link">future.batchtools</a></strong>,
provides a type of futures that utilizes the <strong><a href="https://cran.r-project.org/package=batchtools" class="external-link">batchtools</a></strong>
package. This means that <em>any</em> type of backend that the
<strong>batchtools</strong> package supports can be used as a future.
More specifically, <strong>future.batchtools</strong> will allow you or
users of your package to leverage the compute power of high-performance
computing (HPC) clusters via a simple switch in settings - without
having to change any code at all.</p>
<p>For instance, if <strong>batchtools</strong> is properly configures,
the below two expressions for futures <code>x</code> and <code>y</code>
will be processed on two different compute nodes:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org" class="external-link">future</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="fu">future.batchtools</span><span class="fu">::</span><span class="va"><a href="../reference/batchtools_slurm.html">batchtools_slurm</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">x</span> <span class="op"><a href="https://future.futureverse.org/reference/futureAssign.html" class="external-link">%&lt;-%</a></span> <span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>; <span class="fl">3.14</span> <span class="op">}</span></span>
<span><span class="va">y</span> <span class="op"><a href="https://future.futureverse.org/reference/futureAssign.html" class="external-link">%&lt;-%</a></span> <span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>; <span class="fl">2.71</span> <span class="op">}</span></span>
<span><span class="va">x</span> <span class="op">+</span> <span class="va">y</span></span>
<span><span class="co">#&gt; [1] 5.85</span></span></code></pre></div>
<p>This is just a toy example to illustrate what futures look like and
how to work with them.</p>
<p>A more realistic example comes from the field of cancer research
where very large data FASTQ files, which hold a large number of short
DNA sequence reads, are produced. The first step toward a biological
interpretation of these data is to align the reads in each sample (one
FASTQ file) toward the human genome. In order to speed this up, we can
have each file be processed by a separate compute node and each node we
can use 24 parallel processes such that each process aligns a separate
chromosome. Here is an outline of how this nested parallelism could be
implemented using futures.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org" class="external-link">future</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://listenv.futureverse.org" class="external-link">listenv</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">## The first level of futures should be submitted to the</span></span>
<span><span class="co">## cluster using batchtools.  The second level of futures</span></span>
<span><span class="co">## should be using multisession, where the number of</span></span>
<span><span class="co">## parallel processes is automatically decided based on</span></span>
<span><span class="co">## what the cluster grants to each compute node.</span></span>
<span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu">future.batchtools</span><span class="fu">::</span><span class="va"><a href="../reference/batchtools_slurm.html">batchtools_slurm</a></span>, <span class="va">multisession</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Find all samples (one FASTQ file per sample)</span></span>
<span><span class="va">fqs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"[.]fastq$"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## The aligned results are stored in BAM files</span></span>
<span><span class="va">bams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://listenv.futureverse.org/reference/listenv.html" class="external-link">listenv</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## For all samples (FASTQ files) ...</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">ss</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">fqs</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">fq</span> <span class="op">&lt;-</span> <span class="va">fqs</span><span class="op">[</span><span class="va">ss</span><span class="op">]</span></span>
<span></span>
<span>  <span class="co">## ... use futures to align them ...</span></span>
<span>  <span class="va">bams</span><span class="op">[[</span><span class="va">ss</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://future.futureverse.org/reference/futureAssign.html" class="external-link">%&lt;-%</a></span> <span class="op">{</span></span>
<span>    <span class="va">bams_ss</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://listenv.futureverse.org/reference/listenv.html" class="external-link">listenv</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="co">## ... and for each FASTQ file use a second layer</span></span>
<span>    <span class="co">## of futures to align the individual chromosomes</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">cc</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">24</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">bams_ss</span><span class="op">[[</span><span class="va">cc</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://future.futureverse.org/reference/futureAssign.html" class="external-link">%&lt;-%</a></span> <span class="fu">htseq</span><span class="fu">::</span><span class="fu">align</span><span class="op">(</span><span class="va">fq</span>, chr <span class="op">=</span> <span class="va">cc</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="co">## Resolve the "chromosome" futures and return as a list</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">bams_ss</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="co">## Resolve the "sample" futures and return as a list</span></span>
<span><span class="va">bams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">bams</span><span class="op">)</span></span></code></pre></div>
<p>Note that a user who do not have access to a cluster could use the
same script processing samples sequentially and chromosomes in parallel
on a single machine using:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">sequential</span>, <span class="va">multisession</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>or samples in parallel and chromosomes sequentially using:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">multisession</span>, <span class="va">sequential</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>For an introduction as well as full details on how to use futures,
please consult the package vignettes of the <strong><a href="https://cran.r-project.org/package=future" class="external-link">future</a></strong>
package.</p>
</div>
<div class="section level2">
<h2 id="choosing-batchtools-backend">Choosing batchtools backend<a class="anchor" aria-label="anchor" href="#choosing-batchtools-backend"></a>
</h2>
<p>The <strong>future.batchtools</strong> package implements a generic
future wrapper for all batchtools backends. Below are the most common
types of batchtools backends.</p>
<table class="table">
<colgroup>
<col width="18%">
<col width="54%">
<col width="27%">
</colgroup>
<thead><tr class="header">
<th align="left">Backend</th>
<th align="left">Description</th>
<th align="left">Alternative in future package</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code>batchtools_lsf</code></td>
<td align="left">Futures are evaluated via a <a href="https://en.wikipedia.org/wiki/Platform_LSF" class="external-link">Load Sharing Facility
(LSF)</a> job scheduler</td>
<td align="left">N/A</td>
</tr>
<tr class="even">
<td align="left"><code>batchtools_openlava</code></td>
<td align="left">Futures are evaluated via an <a href="https://en.wikipedia.org/wiki/OpenLava" class="external-link">OpenLava</a> job
scheduler</td>
<td align="left">N/A</td>
</tr>
<tr class="odd">
<td align="left"><code>batchtools_sge</code></td>
<td align="left">Futures are evaluated via a <a href="https://en.wikipedia.org/wiki/Oracle_Grid_Engine" class="external-link">Sun/Oracle Grid
Engine (SGE)</a> job scheduler</td>
<td align="left">N/A</td>
</tr>
<tr class="even">
<td align="left"><code>batchtools_slurm</code></td>
<td align="left">Futures are evaluated via a <a href="https://en.wikipedia.org/wiki/Slurm_Workload_Manager" class="external-link">Slurm</a>
job scheduler</td>
<td align="left">N/A</td>
</tr>
<tr class="odd">
<td align="left"><code>batchtools_torque</code></td>
<td align="left">Futures are evaluated via a <a href="https://en.wikipedia.org/wiki/TORQUE" class="external-link">TORQUE</a> / PBS job
scheduler</td>
<td align="left">N/A</td>
</tr>
<tr class="even">
<td align="left"><code>batchtools_custom</code></td>
<td align="left">Futures are evaluated via a custom batchtools
configuration R script or via a set of cluster functions</td>
<td align="left">N/A</td>
</tr>
<tr class="odd">
<td align="left"><code>batchtools_multicore</code></td>
<td align="left">parallel evaluation by forking the current R
process</td>
<td align="left"><code>plan(multicore)</code></td>
</tr>
<tr class="even">
<td align="left"><code>batchtools_local</code></td>
<td align="left">sequential evaluation in a separate R process (on
current machine)</td>
<td align="left"><code>plan(cluster, workers = I(1))</code></td>
</tr>
</tbody>
</table>
<div class="section level3">
<h3 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h3>
<p>Below is an examples illustrating how to use
<code>batchtools_slurm</code> to configure the batchtools backend. For
further details and examples on how to configure batchtools, see the <a href="https://batchtools.mlr-org.com/articles/batchtools.html" class="external-link">batchtools
configuration</a> wiki page.</p>
<p>To configure <strong>batchtools</strong> for job schedulers we need
to setup a <code>*.tmpl</code> template file that is used to generate
the script used by the scheduler. This is what a template file for Slurm
may look like:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="op">&lt;</span>%</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="ex">defaults</span> <span class="op">&lt;</span>- list<span class="er">(</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>  <span class="ex">nodes</span> = 1,         <span class="co"># single-host processing</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>  <span class="bu">time</span> = <span class="st">"00:05:00"</span>, <span class="co"># 5-min runtime</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>  <span class="ex">mem</span>  = <span class="st">"100M"</span>      <span class="co"># 100 MiB memory</span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="kw">)</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a><span class="ex">resources</span> <span class="op">&lt;</span>- c<span class="er">(</span><span class="ex">resources,</span> defaults[setdiff<span class="er">(</span><span class="ex">names</span><span class="er">(</span><span class="ex">defaults</span><span class="kw">)</span><span class="ex">,</span> names<span class="er">(</span><span class="ex">resources</span><span class="kw">))</span><span class="ex">]</span><span class="kw">)</span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a><span class="ex">opts</span> <span class="op">&lt;</span>- unlist<span class="er">(</span><span class="ex">resources,</span> use.names = TRUE<span class="kw">)</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a><span class="ex">opts</span> <span class="op">&lt;</span>- sprintf<span class="er">(</span><span class="st">"--%s=%s"</span><span class="ex">,</span> names<span class="er">(</span><span class="ex">opts</span><span class="kw">)</span><span class="ex">,</span> opts<span class="kw">)</span></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a><span class="ex">opts</span> <span class="op">&lt;</span>- paste<span class="er">(</span><span class="ex">opts,</span> collapse = <span class="st">" "</span><span class="kw">)</span> <span class="ex">%</span><span class="op">&gt;</span></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a><span class="ex">%</span><span class="op">&gt;</span></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a><span class="co">#SBATCH --job-name=&lt;%= job.name %&gt;</span></span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a><span class="co">#SBATCH --output=&lt;%= log.file %&gt;</span></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a><span class="co">#SBATCH &lt;%= opts %&gt;</span></span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a></span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a><span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">'batchtools::doJobCollection("&lt;%= uri %&gt;")'</span></span></code></pre></div>
<p>If this template is saved to file <code>batchtools.slurm.tmpl</code>
(without period) in the working directory or as
<code>.batchtools.slurm.tmpl</code> (with period) the user’s home
directory, then it will be automatically located by the
<strong>batchtools</strong> framework and loaded when doing:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="fu">future.batchtools</span><span class="fu">::</span><span class="va"><a href="../reference/batchtools_slurm.html">batchtools_slurm</a></span><span class="op">)</span></span></code></pre></div>
<p>It is also possible to specify the template file explicitly, e.g.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="fu">future.batchtools</span><span class="fu">::</span><span class="va"><a href="../reference/batchtools_slurm.html">batchtools_slurm</a></span>, template <span class="op">=</span> <span class="st">"/path/to/batchtools.slurm.tmpl"</span><span class="op">)</span></span></code></pre></div>
<p>Resource parameters can be specified via argument
<code>resources</code> which should be a named list and is passed as is
to the template file. For example, to request that each job would get
alloted 12 cores (one a single machine) and up to 5 GiB of memory,
use:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="fu">future.batchtools</span><span class="fu">::</span><span class="va"><a href="../reference/batchtools_slurm.html">batchtools_slurm</a></span>, resources <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ntasks <span class="op">=</span> <span class="fl">12</span>, mem <span class="op">=</span> <span class="st">"5G"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>To specify the <code>resources</code> argument at the same time as
using nested future strategies, one can use <code><a href="https://future.futureverse.org/reference/plan.html" class="external-link">tweak()</a></code> to
tweak the default arguments. For instance,</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">tweak</a></span><span class="op">(</span><span class="fu">future.batchtools</span><span class="fu">::</span><span class="va"><a href="../reference/batchtools_slurm.html">batchtools_slurm</a></span>, resources <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ntasks <span class="op">=</span> <span class="fl">12</span>, mem <span class="op">=</span> <span class="st">"5G"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="va">multisession</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>causes the first level of futures to be submitted via the Slurm job
scheduler requesting 12 cores and 5 GiB of memory per job. The second
level of futures will be evaluated using multisession using the 12 cores
given to each job by the scheduler.</p>
<p>For further details and examples on how to configure
<strong>batchtools</strong> per se, see the <a href="https://batchtools.mlr-org.com/articles/batchtools.html" class="external-link">batchtools
configuration</a> wiki page and the help pages for
<code>batchtools_slurm</code>, <code>batchtools_sge</code>, etc.</p>
</div>
</div>
<div class="section level2">
<h2 id="demos">Demos<a class="anchor" aria-label="anchor" href="#demos"></a>
</h2>
<p>The <strong><a href="https://cran.r-project.org/package=future" class="external-link">future</a></strong>
package provides a demo using futures for calculating a set of
Mandelbrot planes. The demo does not assume anything about what type of
futures are used. <em>The user has full control of how futures are
evaluated</em>. For instance, to use local batchtools futures, run the
demo as:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org" class="external-link">future</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="fu">future.batchtools</span><span class="fu">::</span><span class="va"><a href="../reference/batchtools_local.html">batchtools_local</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/demo.html" class="external-link">demo</a></span><span class="op">(</span><span class="st">"mandelbrot"</span>, package <span class="op">=</span> <span class="st">"future"</span>, ask <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Henrik Bengtsson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3</p> and <a href="https://github.com/HenrikBengtsson/pkgdown.extras/">pkgdown.extras</a> 0.0.0.9007.</p>
</div>

    </footer>
</div>





  </body>
</html>
